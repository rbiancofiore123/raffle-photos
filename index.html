<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sorteggio Foto</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0f172a; /* slate-900 */
    --bg2:#1e293b; /* slate-800 */
    --accent:#7c9cff;
    --accent-2:#a78bfa;
    --text:#e5e7eb;
    --muted:#cbd5e1;
    --card: rgba(255,255,255,.08);
    --glass: blur(14px) saturate(120%);
    --radius:16px;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 20% -10%, #223 0%, transparent 60%),
      radial-gradient(1000px 800px at 120% 0%, #213 0%, transparent 60%),
      linear-gradient(135deg, #0b1022, #151a33 40%, #10162a);
    display:grid;
    place-items:center;
    padding:24px;
  }
  .app{
    width:min(920px, 100%);
    padding:24px;
  }
  .card{
    background:var(--card);
    backdrop-filter:var(--glass);
    -webkit-backdrop-filter:var(--glass);
    border:1px solid rgba(255,255,255,.12);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:24px;
  }
  h1{
    margin:0 0 8px;
    font-size:clamp(24px, 4vw, 36px);
    letter-spacing:.3px;
  }
  p.lead{
    margin:0 0 18px;
    color:var(--muted);
  }
  .row{
    display:flex;
    gap:16px;
    flex-wrap:wrap;
    align-items:center;
  }
  .stack{display:grid; gap:12px}
  input[type="text"]{
    width:100%;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.25);
    color:var(--text);
    border-radius:12px;
    padding:14px 16px;
    outline:none;
    font-size:16px;
  }
  input[type="text"]::placeholder{color:#96a0b6}
  button{
    appearance:none;
    border:none;
    border-radius:12px;
    padding:14px 42px;
    font-weight:600;
    color:#0f1022;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    cursor:pointer;
    transition:transform .06s ease, filter .2s ease;
  }
  button:hover{transform:translateY(-1px)}
  button:active{transform:translateY(0)}
  button.secondary{
    background:transparent;
    color:var(--text);
    border:1px solid rgba(255,255,255,.2);
  }
  .hidden{display:none !important}
  .center{display:grid; gap:14px; justify-items:center}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px;
    border:1px dashed rgba(255,255,255,.25);
    color:var(--muted); font-size:13px;
  }
  .spacer{height:8px}
  .result{
    display:grid; gap:14px; justify-items:center;
  }
  .photo-wrap{
    position:relative;
    width:min(540px, 100%);
    aspect-ratio:4/3;
    border-radius:16px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,.2);
    background:rgba(0,0,0,.25);
    box-shadow:var(--shadow);
  }
  .photo-wrap img{
    width:100%; height:100%; object-fit:cover; display:block;
    opacity:0; transform:scale(1.02);
    transition:opacity .5s ease, transform .6s ease;
  }
  .photo-wrap img.show{opacity:1; transform:scale(1)}
  .grid{
    display:grid; gap:12px;
    grid-template-columns:repeat(auto-fit, minmax(220px,1fr));
    margin-top:10px;
  }
  /* Toast */
  .toast{
    position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
    background:#0b1022; color:var(--text);
    border:1px solid rgba(255,255,255,.18);
    border-radius:12px; padding:10px 14px; box-shadow:var(--shadow);
    opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(-6px)}
  /* Confetti canvas */
  canvas#confetti{position:fixed; inset:0; pointer-events:none}
</style>
</head>
<body>
<canvas id="confetti"></canvas>

<div class="app">
  <!-- SCHERMATA REGISTRAZIONE -->
  <section id="screen-register" class="card">
    <h1>Benvenuta/o! üéâ</h1>
    <p class="lead">Inserisci il tuo nome per partecipare al sorteggio delle foto.</p>
    <div class="grid">
      <div class="stack">
        <label for="name" class="pill">üë§ Nome partecipante</label>
        <input id="name" type="text" placeholder="il tuo nome" autocomplete="name" />
      </div>
      <div class="stack center">
        <div class="spacer"></div>
        <button id="btn-enter">Entra</button>
      </div>
    </div>
  </section>

  <!-- MENU PRINCIPALE -->
  <section id="screen-menu" class="card hidden">
    <div class="row" style="justify-content:space-between; align-items:baseline">
      <div>
        <h1 id="welcome">Ciao!</h1>
        <p class="lead" id="status-line">Premi ‚ÄúEstrai foto‚Äù.</p>
      </div>
      <div class="row">
        <button id="btn-reset" class="secondary" title="Cambia nome o azzera tutto">Reset</button>
      </div>
    </div>

    <!-- üî¥ Uploader rimosso -->

    <div class="center" style="margin-top:16px">
      <button id="btn-draw" style="min-width:200px">Estrai foto</button>
      <!-- üî¥ Pool info rimosso -->
    </div>

    <div id="result" class="result hidden" style="margin-top:18px">
      <div class="photo-wrap"><img id="photo" alt="Foto estratta" /></div>
      <div class="row" style="justify-content:center">
        <button id="btn-copy" class="secondary">Copia link foto</button>
        <button id="btn-another" class="secondary">Estrai di nuovo</button>
      </div>
    </div>
  </section>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
const IMAGES = [
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo1.JPG",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo2.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo3.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo4.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo5.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo6.JPG",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo7.JPG",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo8.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo9.JPG",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo10.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo11.jpg",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo12.JPG",
  "https://raw.githubusercontent.com/rbiancofiore123/raffle-photos/main/photo13.jpg",
];

const LS = {
  NAME: "raffle:name",
  POOL: "raffle:pool",
  DRAWN: "raffle:drawn",
  LAST: "raffle:last",
};

const $ = sel => document.querySelector(sel);
const screenRegister = $("#screen-register");
const screenMenu = $("#screen-menu");
const inputName = $("#name");
const btnEnter = $("#btn-enter");
const btnReset = $("#btn-reset");
const btnDraw = $("#btn-draw");
const btnCopy = $("#btn-copy");
const btnAnother = $("#btn-another");
const welcome = $("#welcome");
const statusLine = $("#status-line");
const result = $("#result");
const photo = $("#photo");
const toast = $("#toast");
const confettiCanvas = $("#confetti");

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 1800);
}

function save(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
function load(key, fallback=null){
  const v = localStorage.getItem(key);
  try { return v ? JSON.parse(v) : fallback; } catch { return fallback; }
}

function setScreen(which){
  if(which === "register"){
    screenRegister.classList.remove("hidden");
    screenMenu.classList.add("hidden");
  } else {
    screenMenu.classList.remove("hidden");
    screenRegister.classList.add("hidden");
  }
}

const cx = confettiCanvas.getContext("2d");
let confetti = [];
function spawnConfetti(){
  const W = confettiCanvas.width = window.innerWidth;
  const H = confettiCanvas.height = window.innerHeight;
  confetti = Array.from({length: 120}).map(()=>({
    x: Math.random()*W,
    y: -10 - Math.random()*H*0.5,
    r: 2 + Math.random()*4,
    vy: 2 + Math.random()*3,
    vx: -1 + Math.random()*2,
    a: Math.random()*Math.PI*2
  }));
  animateConfetti();
  setTimeout(()=>confetti = [], 1200);
}
function animateConfetti(){
  if(!confetti.length) return;
  const W = confettiCanvas.width, H = confettiCanvas.height;
  cx.clearRect(0,0,W,H);
  confetti.forEach(c=>{
    c.x += c.vx;
    c.y += c.vy;
    c.a += 0.1;
    cx.save();
    cx.translate(c.x,c.y);
    cx.rotate(c.a);
    cx.fillStyle = ["#7c9cff","#a78bfa","#fca5a5","#86efac","#fde68a"][Math.floor(Math.random()*5)];
    cx.fillRect(-c.r, -c.r, c.r*2, c.r*2);
    cx.restore();
  });
  requestAnimationFrame(animateConfetti);
}

function boot(){
  if(IMAGES.length && !load(LS.POOL)){
    const pool = IMAGES.map(src=>({src, name: src.split("/").pop()}));
    save(LS.POOL, pool);
  }
  const storedName = load(LS.NAME);
  if(storedName){
    inputName.value = storedName;
    welcome.textContent = `Ciao, ${storedName}!`;
    setScreen("menu");
    reflectDrawState();
  } else {
    setScreen("register");
  }
}
document.addEventListener("DOMContentLoaded", boot);

function enterWith(name){
  const clean = (name||"").trim();
  if(!clean){
    showToast("Inserisci un nome üòâ");
    inputName.focus();
    return;
  }
  save(LS.NAME, clean);
  welcome.textContent = `Ciao, ${clean}!`;
  setScreen("menu");
  reflectDrawState();
}
btnEnter.addEventListener("click", ()=> enterWith(inputName.value));
inputName.addEventListener("keydown", e=>{ if(e.key==="Enter") enterWith(inputName.value); });

function reflectDrawState(){
  const name = load(LS.NAME);
  const drawn = load(LS.DRAWN, false);
  const last = load(LS.LAST, null);
  const pool = load(LS.POOL, []);
  if(!pool.length){
    statusLine.textContent = "Nessuna foto disponibile nel pool.";
  } else if(drawn && last){
    statusLine.textContent = `${name}, hai gi√† estratto questa foto.`;
    showResult(last);
  } else {
    statusLine.textContent = "Tutto pronto! Premi ‚ÄúEstrai foto‚Äù.";
    hideResult();
  }
}
function hideResult(){ result.classList.add("hidden"); photo.classList.remove("show"); }
function showResult(src){
  result.classList.remove("hidden");
  photo.src = src;
  photo.onload = ()=> photo.classList.add("show");
}

btnDraw.addEventListener("click", ()=>{
  const pool = load(LS.POOL, []);
  if(!pool.length){ showToast("Nessuna foto disponibile"); return; }
  const idx = Math.floor(Math.random()*pool.length);
  const chosen = pool[idx];
  pool.splice(idx,1);
  save(LS.POOL, pool);
  save(LS.DRAWN, true);
  save(LS.LAST, chosen.src);
  showResult(chosen.src);
  spawnConfetti();
  statusLine.textContent = "Foto estratta! üéâ";
});
btnAnother.addEventListener("click", ()=>{ save(LS.DRAWN, false); reflectDrawState(); });
btnCopy.addEventListener("click", async ()=>{
  const src = load(LS.LAST, null);
  if(!src){ showToast("Nessuna foto da copiare"); return; }
  try{ await navigator.clipboard.writeText(src); showToast("Link copiato negli appunti"); }
  catch{ showToast("Impossibile copiare il link"); }
});
btnReset.addEventListener("click", ()=>{
  if(!confirm("Vuoi azzerare tutto? (nome ed estrazioni)")) return;
  localStorage.removeItem(LS.NAME);
  localStorage.removeItem(LS.POOL);
  localStorage.removeItem(LS.DRAWN);
  localStorage.removeItem(LS.LAST);
  inputName.value = "";
  hideResult();
  setScreen("register");
  showToast("Dati azzerati");
});
</script>
</body>
</html>
